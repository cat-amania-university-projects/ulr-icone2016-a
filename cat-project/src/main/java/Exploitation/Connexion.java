package Exploitation;


import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import com.mongodb.BasicDBObject;
import com.mongodb.DB;
import com.mongodb.DBCollection;
import com.mongodb.DBCursor;
import com.mongodb.DBObject;
import com.mongodb.MongoClient;

 public  class Connexion{
	static public DB db;
	
 public void connecter(){
	 try{	
         MongoClient mongoClient = new MongoClient( "localhost" , 27017 );	
         db = mongoClient.getDB( "testbd" );
     } catch (Exception e) {System.out.println(e);}
   }

  /**
   * 
   * @param collection
   * @return
   */         
 
   public void insert(String nom){
	   DBCollection coll = db.getCollection("recherche");
	   BasicDBObject doc2 = new BasicDBObject("title", "MongoDB").
	   append("Nom", nom);	
	   coll.insert(doc2);
   }
   
   public List<ObjetResultat> getInformation(String mot){
	   
     DBCollection coll = db.getCollection("recherche");
     BasicDBObject whereQuery = new BasicDBObject();
     BasicDBObject regexQuery = new BasicDBObject();
     regexQuery.put("mot_cle",
	new BasicDBObject("$regex", mot+".*")
	.append("$options", "i"));
     
     whereQuery.put("mot_cle", mot);
     
     List<ObjetResultat> listResultat = new ArrayList<ObjetResultat>();
 
     BasicDBObject query = new BasicDBObject();
     query.put("pertinence",-1);
     
     int i=1;
     DBCursor cursor = coll.find(regexQuery).sort(query);
     while (cursor.hasNext()) {
    	 ObjetResultat ob=new ObjetResultat(); 
         BasicDBObject obj = (BasicDBObject) cursor.next();       
        ob.setdescription(obj.getString("description"));
        ob.settitre(obj.getString("titre"));
        ob.seturl(obj.getString("url"));
        ob.setconcurrent(obj.getString("concurrent"));
        listResultat.add(ob);
        i++;
       }
	
     return listResultat;
       
 }
   /*
 public static void main(String[] args) {
      Connexion ms=new Connexion();
      ms.connecter();
      List<ObjetResultat> listResultat1 = new ArrayList<ObjetResultat>();
	  listResultat1 = ms.getInformation("PHP");
    }*/
 
}

